// 【修正対応済・完全版】GAS用：会員一覧HTML生成スクリプト（テンプレ崩れ対策・連結方式）
function generateMemberListHTML() {
  const sheet = SpreadsheetApp.getActiveSpreadsheet().getSheetByName("会員データ");
  const data = sheet.getDataRange().getValues();
  const folder = DriveApp.getFolderById("1xC3IoxIHk7U34FhdnxmRwcOkOXmw4PcW");
  const filename = "member_list.html";

  let html = "";
  html += '<!DOCTYPE html>\n';
  html += '<html lang="ja">\n';
  html += '<head>\n';
  html += '  <meta charset="UTF-8">\n';
  html += '  <meta name="viewport" content="width=device-width, initial-scale=1.0">\n';
  html += '  <title>members_list - PRIVATE SHIROKANE</title>\n';
  html += '  <link rel="icon" href="images/logo_1.png" type="image/png">\n';
  html += '  <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@400;700&display=swap" rel="stylesheet">\n';
  html += '  <link rel="stylesheet" href="styles/style.css">\n';
  html += '  <script src="scripts/search.js" defer></script>\n';
  html += '</head>\n';
  html += '<body>\n';
  html += '<header class="nav-container">\n';
  html += '  <div class="nav-logo"><a href="top.html"><img src="images/logo_1.png" alt="PRIVATE SHIROKANE Logo"></a></div>\n';
  html += '  <nav class="nav-links" id="navLinks">\n';
  html += '    <a href="index.html">Home</a><a href="top.html">Top</a><a href="guidance_men.html">男性会員入会</a><a href="guidance_women.html">女性会員入会</a><a href="system.html">料金・システム</a><a href="pickup_member.html">注目会員様情報</a><a href="members_only.html">会員専用Page</a><a href="contact.html">お問合せ</a>\n';
  html += '  </nav>\n';
  html += '  <div class="hamburger" onclick="toggleMenu()"><span></span><span></span><span></span></div>\n';
  html += '</header>\n';
  html += '<div class="banner"></div>\n';
  html += '<button class="search-button" onclick="document.getElementById(\'searchModal\').style.display=\'block\'">Search</button>\n';
  html += '<div id="searchModal" class="modal">\n';
  html += '  <div class="modal-content">\n';
  html += '    <span class="close" onclick="document.getElementById(\'searchModal\').style.display=\'none\'">&times;</span>\n';
  html += '    <h2>会員検索</h2>\n';
  html += '    <form class="search-form">\n';
  html += '      <label>年齢（From / To）<br><select id="ageFrom"></select> ～ <select id="ageTo"></select></label>\n';
  html += '      <label>身長（From / To）<br><select id="heightFrom"></select> ～ <select id="heightTo"></select></label>\n';
  html += '      <label>B（From / To）<br><select id="bustFrom"></select> ～ <select id="bustTo"></select></label>\n';
  html += '      <label>W（From / To）<br><select id="waistFrom"></select> ～ <select id="waistTo"></select></label>\n';
  html += '      <label>H（From / To）<br><select id="hipFrom"></select> ～ <select id="hipTo"></select></label>\n';
  html += '      <label>Cup（From / To）<br><select id="cupFrom"></select> ～ <select id="cupTo"></select></label>\n';
  html += '      <label>趣味（部分一致）<br><input type="text" id="hobby"></label>\n';
  html += '    </form>\n';
  html += '    <div class="search-results">※ここに結果が表示されます</div>\n';
  html += '  </div>\n';
  html += '</div>\n';
  html += '<div class="card-container">\n';

  for (let i = 1; i < data.length; i++) {
    const row = data[i];
    const no = row[3]; if (!no) continue;
    const name = row[4];
    const b = row[5], cup = row[6], w = row[7], h = row[8];
    const height = row[9];
    const age = row[20] ? row[20] : '';
    const comment = row[16];
    const photoUrls = row[2] ? row[2].split(',').map(s => s.trim()).filter(x => x) : [];
    const slides = photoUrls.slice(0, 4).map((_, index) => `<div class='slide${index === 0 ? " active" : ""}'><img src='images/photo${no}_${index + 1}.jpg'></div>`).join("\n");

    html += `<div class="card">
      <div class="card-image" onclick="window.open('member${no}.html', '_blank')">
        ${slides}
      </div>
      <div class="card-text">
        <p><strong>No.</strong> ${no} ${name}</p>
        <p>${height}cm${age ? ` (${age}歳)` : ''}</p>
        <p>${b}, ${w}, ${h}, ${cup}カップ</p>
        <p class="comment">${comment}</p>
        <p><span class="favorite-btn" data-id="${no}">?</span></p>
      </div>
    </div>`;
  }

  html += '</div>\n';
  html += '<script>\n';
  html += 'function toggleMenu() { document.getElementById("navLinks").classList.toggle("active"); }\n';
  html += 'window.onclick = function(event) { const modal = document.getElementById("searchModal"); if (event.target == modal) { modal.style.display = "none"; } };\n';
  html += '</script>\n';
  html += '</body>\n';
  html += '</html>\n';

  folder.createFile(filename, html, MimeType.HTML);
  Logger.log(`? 完成HTML出力: ${filename}`);
}<div class="card">
  <div class="card-image" onclick="window.open('member201.html', '_blank')">
    <div class='slide active'><img src='images/photo201_1.jpg'></div>
<div class='slide'><img src='images/photo201_2.jpg'></div>
<div class='slide'><img src='images/photo201_3.jpg'></div>
<div class='slide'><img src='images/photo201_4.jpg'></div>
  </div>
  <div class="card-text">
    <p><strong>No.</strong> 201 本田ゆうり</p>
    <p>158cm (21歳)</p>
    <p>84, 56, 84, Eカップ</p>
    <p class="comment">初めまして。ゆうりです。 美味しいご飯を食べることお話すること大好きです。 素敵な時間を過ごせたら嬉しいです。 よろしくお願いします</p>
    <p><span class="favorite-btn" data-id="201">?</span></p>
  </div>
</div>
<div class="card">
  <div class="card-image" onclick="window.open('member202.html', '_blank')">
    <div class='slide active'><img src='images/photo202_1.jpg'></div>
<div class='slide'><img src='images/photo202_2.jpg'></div>
<div class='slide'><img src='images/photo202_3.jpg'></div>
<div class='slide'><img src='images/photo202_4.jpg'></div>
  </div>
  <div class="card-text">
    <p><strong>No.</strong> 202 水乃なのは</p>
    <p>162cm (23歳)</p>
    <p>87, 57, 85, Fカップ</p>
    <p class="comment">スタイルでよく褒められるのは胸の形とクビレです。 癒し系の雰囲気で話し方がおっとりしてます。 将来の目標の為にこの活動を始めました。 よろしくお願いします。</p>
    <p><span class="favorite-btn" data-id="202">?</span></p>
  </div>
</div>
<div class="card">
  <div class="card-image" onclick="window.open('member204.html', '_blank')">
    <div class='slide active'><img src='images/photo204_1.jpg'></div>
<div class='slide'><img src='images/photo204_2.jpg'></div>
<div class='slide'><img src='images/photo204_3.jpg'></div>
<div class='slide'><img src='images/photo204_4.jpg'></div>
  </div>
  <div class="card-text">
    <p><strong>No.</strong> 204 水咲ななせ</p>
    <p>163cm (23歳)</p>
    <p>83, 57, 85, Dカップ</p>
    <p class="comment">おっとりしてる性格だと思います?? 素敵な方と会えたら嬉しいです? よろしくお願いいたします??</p>
    <p><span class="favorite-btn" data-id="204">?</span></p>
  </div>
</div>
<div class="card">
  <div class="card-image" onclick="window.open('member205.html', '_blank')">
    <div class='slide active'><img src='images/photo205_1.jpg'></div>
<div class='slide'><img src='images/photo205_2.jpg'></div>
<div class='slide'><img src='images/photo205_3.jpg'></div>
<div class='slide'><img src='images/photo205_4.jpg'></div>
  </div>
  <div class="card-text">
    <p><strong>No.</strong> 205 藤崎あいか</p>
    <p>166cm (29歳)</p>
    <p>85, 57, 86, Eカップ</p>
    <p class="comment">意外に天真爛漫でお話しも好きです?? 皆さんのいろんな経験や知識を教えてほしいです?</p>
    <p><span class="favorite-btn" data-id="205">?</span></p>
  </div>
</div>
<div class="card">
  <div class="card-image" onclick="window.open('member206.html', '_blank')">
    <div class='slide active'><img src='images/photo206_1.jpg'></div>
<div class='slide'><img src='images/photo206_2.jpg'></div>
<div class='slide'><img src='images/photo206_3.jpg'></div>
<div class='slide'><img src='images/photo206_4.jpg'></div>
  </div>
  <div class="card-text">
    <p><strong>No.</strong> 206 西内さくら</p>
    <p>163cm (26歳)</p>
    <p>90, 53, 86, Gカップ</p>
    <p class="comment">人をあたたかい気持ちにさせることが得意です。 いい出会いがありますように?? よろしくお願いします??</p>
    <p><span class="favorite-btn" data-id="206">?</span></p>
  </div>
</div>
<div class="card">
  <div class="card-image" onclick="window.open('member207.html', '_blank')">
    <div class='slide active'><img src='images/photo207_1.jpg'></div>
<div class='slide'><img src='images/photo207_2.jpg'></div>
<div class='slide'><img src='images/photo207_3.jpg'></div>
<div class='slide'><img src='images/photo207_4.jpg'></div>
  </div>
  <div class="card-text">
    <p><strong>No.</strong> 207 斉藤るか </p>
    <p>155cm (24歳)</p>
    <p>84, 58, 86, Dカップ</p>
    <p class="comment">るかです。宜しくお願い致します☆</p>
    <p><span class="favorite-btn" data-id="207">?</span></p>
  </div>
</div>
<div class="card">
  <div class="card-image" onclick="window.open('member208.html', '_blank')">
    <div class='slide active'><img src='images/photo208_1.jpg'></div>
<div class='slide'><img src='images/photo208_2.jpg'></div>
<div class='slide'><img src='images/photo208_3.jpg'></div>
<div class='slide'><img src='images/photo208_4.jpg'></div>
  </div>
  <div class="card-text">
    <p><strong>No.</strong> 208 白石もも  </p>
    <p>170cm (21歳)</p>
    <p>90, 55, 90, Dカップ</p>
    <p class="comment">素を出すことのできる優しい男性と出会いたいです。 よろしくお願いします??</p>
    <p><span class="favorite-btn" data-id="208">?</span></p>
  </div>
</div>
</div>
<script>
function toggleMenu() {
  document.getElementById("navLinks").classList.toggle("active");
}
document.querySelectorAll('.card-image').forEach(container => {
  const slides = container.querySelectorAll('.slide');
  let idx = 0;
  if (slides.length === 1) { slides[0].classList.add('active'); return; }
  slides[0].classList.add('active');
  setInterval(() => {
    slides[idx].classList.remove('active');
    idx = (idx + 1) % slides.length;
    slides[idx].classList.add('active');
  }, 3000);
});
document.querySelectorAll('.favorite-btn').forEach(btn => {
  const id = btn.dataset.id;
  if (localStorage.getItem('fav-' + id)) btn.textContent = '??';
  btn.addEventListener('click', () => {
    if (localStorage.getItem('fav-' + id)) {
      localStorage.removeItem('fav-' + id);
      btn.textContent = '?';
    } else {
      localStorage.setItem('fav-' + id, '1');
      btn.textContent = '??';
    }
  });
});
</script>
</body>
</html>
