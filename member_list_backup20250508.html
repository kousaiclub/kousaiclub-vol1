// 【修正対応済・完全版】GAS用：会員一覧HTML生成スクリプト（テンプレ崩れ対策・連結方式）
function generateMemberListHTML() {
  const sheet = SpreadsheetApp.getActiveSpreadsheet().getSheetByName("会員データ");
  const data = sheet.getDataRange().getValues();
  const folder = DriveApp.getFolderById("1xC3IoxIHk7U34FhdnxmRwcOkOXmw4PcW");
  const filename = "member_list.html";

  let html = "";
  html += '<!DOCTYPE html>\n';
  html += '<html lang="ja">\n';
  html += '<head>\n';
  html += '  <meta charset="UTF-8">\n';
  html += '  <meta name="viewport" content="width=device-width, initial-scale=1.0">\n';
  html += '  <title>members_list - PRIVATE SHIROKANE</title>\n';
  html += '  <link rel="icon" href="images/logo_1.png" type="image/png">\n';
  html += '  <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@400;700&display=swap" rel="stylesheet">\n';
  html += '  <style>\n';
  html += '    body { margin:0; padding:0; background:#1c1c1c; color:#f9f9f9; font-family:"Cormorant Garamond",serif; font-size:14px; line-height:1.8; }\n';
  html += '    .nav-container { display:flex; align-items:center; justify-content:space-between; background:rgba(0,0,0,0.6); padding:5px 20px; font-size:14px; z-index:10; }\n';
  html += '    .nav-logo img { height:50px; object-fit:contain; filter:brightness(90%) drop-shadow(0 1px 1px #ccc); }\n';
  html += '    .nav-links { display:flex; gap:20px; }\n';
  html += '    .nav-links a { color:#f0f0f0; text-decoration:none; }\n';
  html += '    .hamburger { display:none; flex-direction:column; cursor:pointer; }\n';
  html += '    .hamburger span { height:3px; width:25px; background:#f9f9f9; margin:4px 0; }\n';
  html += '    @media screen and (max-width:768px) {\n';
  html += '      .nav-links { display:none; flex-direction:column; width:100%; position:absolute; top:60px; left:0; background:rgba(0,0,0,0.9); padding:15px; }\n';
  html += '      .nav-links.active { display:flex; }\n';
  html += '      .hamburger { display:flex; }\n';
  html += '    }\n';
  html += '    .banner { background:url(\'images/banner_3.png\') no-repeat left center; background-size:cover; height:340px; }\n';
  html += '    .card-container { display:flex; flex-wrap:wrap; justify-content:flex-start; gap:1%; padding:20px; }\n';
  html += '    .card { width:22%; background:#1c1c1c; border:1px solid #f9f9f9; border-radius:12px; margin-bottom:20px; overflow:hidden; }\n';
  html += '    .card-image { position:relative; aspect-ratio:3/4; overflow:hidden; cursor:pointer; }\n';
  html += '    .slide { position:absolute; top:0; left:0; width:100%; height:100%; opacity:0; transition:opacity 0.6s ease-in-out; }\n';
  html += '    .slide.active { opacity:1; }\n';
  html += '    .slide img { width:100%; height:100%; object-fit:cover; }\n';
  html += '    .card-text { padding:8px; text-align:center; }\n';
  html += '    .favorite-btn { font-size:18px; color:#FF69B4; cursor:pointer; }\n';
  html += '    .comment { white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }\n';
  html += '    @media (max-width:768px) { .card { width:48%; } }\n';
  html += '  </style>\n';
  html += '</head>\n';
  html += '<body>\n';
  html += '<header class="nav-container">\n';
  html += '  <div class="nav-logo"><a href="top.html"><img src="images/logo_1.png" alt="PRIVATE SHIROKANE Logo"></a></div>\n';
  html += '  <nav class="nav-links" id="navLinks">\n';
  html += '    <a href="index.html">Home</a><a href="top.html">Top</a><a href="guidance_men.html">男性会員入会</a><a href="guidance_women.html">女性会員入会</a><a href="system.html">料金・システム</a><a href="pickup_member.html">注目会員様情報</a><a href="members_only.html">会員専用Page</a><a href="contact.html">お問合せ</a>\n';
  html += '  </nav>\n';
  html += '  <div class="hamburger" onclick="toggleMenu()"><span></span><span></span><span></span></div>\n';
  html += '</header>\n';
  html += '<div class="banner"></div>\n';
  html += '<div class="card-container">\n';

  for (let i = 1; i < data.length; i++) {
    const row = data[i];
    const no = row[3]; if (!no) continue;
    const name = row[4];
    const b = row[5], cup = row[6], w = row[7], h = row[8];
    const height = row[9];
    const age = row[20] ? row[20] : '';
    const comment = row[16];
    const photoUrls = row[2] ? row[2].split(',').map(s => s.trim()).filter(x => x) : [];
    const slides = photoUrls.slice(0, 4).map((_, index) => `<div class='slide${index === 0 ? " active" : ""}'><img src='images/photo${no}_${index + 1}.jpg'></div>`).join("\n");

    html += `<div class="card">
      <div class="card-image" onclick="window.open('member${no}.html', '_blank')">
        ${slides}
      </div>
      <div class="card-text">
        <p><strong>No.</strong> ${no} ${name}</p>
        <p>${height}cm${age ? ` (${age}歳)` : ''}</p>
        <p>${b}, ${w}, ${h}, ${cup}カップ</p>
        <p class="comment">${comment}</p>
        <p><span class="favorite-btn" data-id="${no}">♡</span></p>
      </div>
    </div>`;
  }

  html += '</div>\n';
  html += '<script>\n';
  html += 'function toggleMenu() { document.getElementById("navLinks").classList.toggle("active"); }\n';
  html += '</script>\n';
  html += '</body>\n';
  html += '</html>\n';

  folder.createFile(filename, html, MimeType.HTML);
  Logger.log(`✅ 完成HTML出力: ${filename}`);
}
